/**
 * -------------------------------------------------------------------------------------
 * LANG CONFIGURATION //////////////////////////////////////////////////////////////////
 * -------------------------------------------------------------------------------------
 */

var array_lang_value = {
	// fr : French
	"fr": { // French
		"HONO_BUTTON" : "Négocier le prix",
		"MODAL_TITLE" : "Négociez le prix qui vous convient le mieux pour",
		"MODAL_HOW_MUCH_DO_YOU_HAVE":"De combien disposez vous?",
		"MODAL_NEXT_BUTTON" : "Suivant",
		"MODAL_SEND_BUTTON" : "Envoyer",
		"MODAL_LEAVE_INFO" : "Laissez quelques informations pour être contacté plus tard par le vendeur",
		"MODAL_ASK_NUMBER" : "Numero de telephone(Facultatif)",
		"MODAL_LEAVE_MESSAGE_PLACEHOLDER" : "Laissez un court message au vendeur (pas plus de 100 lettres) Ex: Merci de me faire signe au plus tot.",
		"MODAL_MESSAGE_SENT_SUCCESS" : "Message envoyé avec succès!",
		"MODAL_INDICATION_MESSAGE1" : " Une interface de TCHAT est déjà disponible pour que vous echangier sur des détails suplémentaires avec le vendeur, vous pouvez y accéder pour en discutter en ",
		"MODAL_INDICATION_MESSAGE2" : "cliquant ici",
		"ALERT_YOURMONEY_TOO_SMALL1" : "Votre montant est trop bas, il vous reste ",
		"ALERT_YOURMONEY_TOO_SMALL2" : " essaie(s).",
		"EMAIL_HELLO_MESSAGE" : "Hello, nous avons une demande de négociation de prix sur votre article, voici les details",
		"EMAIL_INTITULE_ARTICLE" : "Produit",
		"EMAIL_INTITULE_AMOUNT" : "Prix",
		"EMAIL_INTITULE_PROPOSITION" : "Proposition",
		"EMAIL_INTITULE_EMAIL" : "Email",
		"EMAIL_INTITULE_NUMERO" : "Numéro de téléphone",
		"EMAIL_INTITULE_MESSAGE" : "Message",
		"EMAIL_JOIN_TCHAT_MESSAGE1" : "Vous pouvez rejoindre le client sur notre service de TCHAT gratuit, pour échanger gratuitement en ",
		"EMAIL_JOIN_TCHAT_MESSAGE2" : "cliquant ici",
		"FILL_CORRECTLY_FORMMAIL": "Remplissez correctement le formulaire."
	},
	"en": { //  English
		"HONO_BUTTON" : "Negotiate the price",
		"MODAL_TITLE" : "Negotiate the price that suits you best for",
		"MODAL_HOW_MUCH_DO_YOU_HAVE":"How much do you have?",
		"MODAL_NEXT_BUTTON" : "Next",
		"MODAL_SEND_BUTTON" : "Send",
		"MODAL_LEAVE_INFO" : "Leave some information to be contacted later by the seller",
		"MODAL_ASK_NUMBER" : "Phone number (Optional)",
		"MODAL_LEAVE_MESSAGE_PLACEHOLDER" : "Leave a short message to the seller (no more than 100 letters) Ex: Thank you to sign me as soon as possible.",
		"MODAL_MESSAGE_SENT_SUCCESS" : "Message sent successfully!",
		"MODAL_INDICATION_MESSAGE1" : " A TCHAT interface is already available for you to exchange on additional details with the seller, you can access to discuss it ",
		"MODAL_INDICATION_MESSAGE2" : "by clicking here",
		"ALERT_YOURMONEY_TOO_SMALL1" : "Your amount is too low, you have ",
		"ALERT_YOURMONEY_TOO_SMALL2" : " essays left.",
		"EMAIL_HELLO_MESSAGE" : "Hello, we have a price negotiation request on your item, here are the details",
		"EMAIL_INTITULE_ARTICLE" : "Product",
		"EMAIL_INTITULE_AMOUNT" : "Amount",
		"EMAIL_INTITULE_PROPOSITION" : "Proposal",
		"EMAIL_INTITULE_EMAIL" : "E-mail",
		"EMAIL_INTITULE_NUMERO" : "Phone number",
		"EMAIL_INTITULE_MESSAGE" : "Message",
		"EMAIL_JOIN_TCHAT_MESSAGE1" : "You can join the customer on our free TCHAT service, to exchange for free by ",
		"EMAIL_JOIN_TCHAT_MESSAGE2" : "clicking here",
		"FILL_CORRECTLY_FORMMAIL": "Please, fill correctly the form."
	},
	"sp":{ // Spanish
		"HONO_BUTTON" : "Negociar el precio",
		"MODAL_TITLE" : "Negocie el precio que más le convenga.",
		"MODAL_HOW_MUCH_DO_YOU_HAVE":"Cuanto tienes?",
		"MODAL_NEXT_BUTTON" : "Siguiente",
		"MODAL_SEND_BUTTON" : "Enviar",
		"MODAL_LEAVE_INFO" : "Deja alguna información para ser contactado más tarde por el vendedor.",
		"MODAL_ASK_NUMBER" : "Número de teléfono (opcional)",
		"MODAL_LEAVE_MESSAGE_PLACEHOLDER" : "Deje un mensaje breve para el vendedor (no más de 100 letras) Ej: Gracias por firmar lo antes posible.",
		"MODAL_MESSAGE_SENT_SUCCESS" : "Mensaje enviado con éxito!",
		"MODAL_INDICATION_MESSAGE1" : " Ya está disponible una interfaz TCHAT para que pueda intercambiar información adicional con el vendedor, puede acceder para discutirla haciendo ",
		"MODAL_INDICATION_MESSAGE2" : "clic aquí.",
		"ALERT_YOURMONEY_TOO_SMALL1" : "Tu cantidad es muy baja, te quedan ",
		"ALERT_YOURMONEY_TOO_SMALL2" : " ensayos.",
		"EMAIL_HELLO_MESSAGE" : "Hola, tenemos una solicitud de negociación de precio en su artículo, aquí están los detalles",
		"EMAIL_INTITULE_ARTICLE" : "Producto",
		"EMAIL_INTITULE_AMOUNT" : "Cantidad",
		"EMAIL_INTITULE_PROPOSITION" : "Propuesta",
		"EMAIL_INTITULE_EMAIL" : "E-mail",
		"EMAIL_INTITULE_NUMERO" : "Número de teléfono",
		"EMAIL_INTITULE_MESSAGE" : "Mensaje",
		"EMAIL_JOIN_TCHAT_MESSAGE1" : "Puede unirse al cliente en nuestro servicio gratuito TCHAT, para intercambiar de forma gratuita haciendo ",
		"EMAIL_JOIN_TCHAT_MESSAGE2" : "clic aquí",
		"FILL_CORRECTLY_FORMMAIL": "Please, fill correctly the form."
	},
	"ge":{ //  German
		"HONO_BUTTON" : "Verhandeln Sie den Preis",
		"MODAL_TITLE" : "Verhandeln Sie den Preis, der am besten zu Ihnen passt",
		"MODAL_HOW_MUCH_DO_YOU_HAVE":"Wie viel hast du?",
		"MODAL_NEXT_BUTTON" : "Weiter",
		"MODAL_SEND_BUTTON" : "senden",
		"MODAL_LEAVE_INFO" : "Hinterlassen Sie einige Informationen, um später vom Verkäufer kontaktiert zu werden",
		"MODAL_ASK_NUMBER" : "Telefonnummer (optional)",
		"MODAL_LEAVE_MESSAGE_PLACEHOLDER" : "Hinterlassen Sie eine kurze Nachricht an den Verkäufer (nicht mehr als 100 Buchstaben) Bsp: Vielen Dank, dass Sie mich so bald wie möglich unterschreiben.",
		"MODAL_MESSAGE_SENT_SUCCESS" : "Nachricht erfolgreich gesendet!",
		"MODAL_INDICATION_MESSAGE1" : " Eine TCHAT-Schnittstelle steht Ihnen bereits zur Verfügung, um weitere Details mit dem Verkäufer auszutauschen. Sie können diese hier einsehen, indem Sie hier ",
		"MODAL_INDICATION_MESSAGE2" : "klicken",
		"ALERT_YOURMONEY_TOO_SMALL1" : "Ihr Betrag ist zu niedrig, Sie haben noch ",
		"ALERT_YOURMONEY_TOO_SMALL2" : " Aufsätze.",
		"EMAIL_HELLO_MESSAGE" : "Hallo, wir haben eine Preisverhandlung Anfrage auf Ihren Artikel, hier sind die Details",
		"EMAIL_INTITULE_ARTICLE" : "Produkt",
		"EMAIL_INTITULE_AMOUNT" : "Menge",
		"EMAIL_INTITULE_PROPOSITION" : "Vorschlag",
		"EMAIL_INTITULE_EMAIL" : "E-Mail",
		"EMAIL_INTITULE_NUMERO" : "Telefonnummer",
		"EMAIL_INTITULE_MESSAGE" : "Nachricht",
		"EMAIL_JOIN_TCHAT_MESSAGE1" : "Sie können dem Kunden auf unserem kostenlosen TCHAT-Dienst beitreten, um kostenlos umzutauschen, indem ",
		"EMAIL_JOIN_TCHAT_MESSAGE2" : "Sie hier klicken",
		"FILL_CORRECTLY_FORMMAIL": "Please, fill correctly the form."
	}
};

/**
 * [Buttonstyles Styles for the button]
 * @type {String}
 */
var Buttonstyles = "@import url(https://fonts.googleapis.com/css?family=Josefin+Slab:100,300,400,600,700); .honobtnBlueGreen{border:0;padding:5px;color:#fff;background:#00AE68}.honobtnLightBlue{border:0;padding:5px;color:#fff;background:#5DC8CD}.honobtnOrange{border:0;padding:5px;color:#fff;background:#FFAA40}.honobtnPurple{border:0;padding:5px;color:#fff;background:#A74982}.honobtnFade.honobtnBlueGreen:hover{background:#21825B}.honobtnFade.honobtnLightBlue:hover{background:#01939A}.honobtnFade.honobtnOrange:hover{background:#FF8E00}.honobtnFade.honobtnPurple:hover{background:#6D184B}.honobtnBlueGreen.honobtnPush{box-shadow:0 5px 0 0 #007144}.honobtnLightBlue.honobtnPush{box-shadow:0 5px 0 0 #1E8185}.honobtnOrange.honobtnPush{box-shadow:0 5px 0 0 #A66615}.honobtnPurple.honobtnPush{box-shadow:0 5px 0 0 #6D184B}.honobtnPush:hover{margin-top:15px;margin-bottom:5px}.honobtnBlueGreen.honobtnPush:hover{box-shadow:0 0 0 0 #007144}.honobtnLightBlue.honobtnPush:hover{box-shadow:0 0 0 0 #1E8185}.honobtnOrange.honobtnPush:hover{box-shadow:0 0 0 0 #A66615}.honobtnPurple.honobtnPush:hover{box-shadow:0 0 0 0 #6D184B}.honobtnBlueGreen.honobtnBorder{box-shadow:0 0 0 0 #21825B}.honobtnBlueGreen.honobtnBorder:hover{box-shadow:0 0 0 5px #21825B}.honobtnLightBlue.honobtnBorder{box-shadow:0 0 0 0 #01939A}.honobtnLightBlue.honobtnBorder:hover{box-shadow:0 0 0 5px #01939A}.honobtnOrange.honobtnBorder{box-shadow:0 0 0 0 #A66615}.honobtnOrange.honobtnBorder:hover{box-shadow:0 0 0 5px #A66615}.honobtnPurple.honobtnBorder{box-shadow:0 0 0 0 #6D184B}.honobtnPurple.honobtnBorder:hover{box-shadow:0 0 0 5px #6D184B}";

/**
 * [image_logo Image LOGO Base64 encoding]
 * @type {String}
 */
var image_logo = "data:image/png;base64,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";

/**
 * --------------------------------------------------------------------------------------
 * FUNCTIONS CODE ///////////////////////////////////////////////////////////////////////
 * --------------------------------------------------------------------------------------
*/
// Functions
/* SmtpJS.com - v3.0.0 */
var Email = { send: function (a) { return new Promise(function (n, e) { a.nocache = Math.floor(1e6 * Math.random() + 1), a.Action = "Send"; var t = JSON.stringify(a); Email.ajaxPost("https://smtpjs.com/v3/smtpjs.aspx?", t, function (e) { n(e) }) }) }, ajaxPost: function (e, n, t) { var a = Email.createCORSRequest("POST", e); a.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), a.onload = function () { var e = a.responseText; null != t && t(e) }, a.send(n) }, ajax: function (e, n) { var t = Email.createCORSRequest("GET", e); t.onload = function () { var e = t.responseText; null != n && n(e) }, t.send() }, createCORSRequest: function (e, n) { var t = new XMLHttpRequest; return "withCredentials" in t ? t.open(e, n, !0) : "undefined" != typeof XDomainRequest ? (t = new XDomainRequest).open(e, n) : t = null, t } };

var a; // A useless Variable LOL
var currentdate = new Date(), 
  datetime = currentdate.getFullYear() + "-" +  
  get2D(currentdate.getMonth()+1) + "-" + 
  get2D(currentdate.getDate());


function get2D( num ) {
    if( num.toString().length < 2 ) // Integer of less than two digits
        return "0" + num; // Prepend a zero!
    return num.toString(); // return string for consistency
}
/**
 * [IDGenerator description]
 */
function IDGenerator() {

	this.length = 8;
	this.timestamp = +new Date;

	var _getRandomInt = function( min, max ) {
		return Math.floor( Math.random() * ( max - min + 1 ) ) + min;
	}

	this.generate = function() {
	 var ts = this.timestamp.toString();
	 var parts = ts.split( "" ).reverse();
	 var id = "";
	 
	 for( var i = 0; i < this.length; ++i ) {
		var index = _getRandomInt( 0, parts.length - 1 );
		id += parts[index];	 
	 }
	 
	 return id;
	}
}

function getRealValue_or_default(attribute, default_value){
	return (typeof attribute === 'undefined' || attribute == null || attribute === null) ? default_value: attribute; 
}

/**
 * [BuildButton description]
 * @param {[type]} button [description]
 */

function BuildButton(button){
	div_hono.innerHTML = "";

	//button.removeChild(document.createTextNode(div_hono_button_text));
	button.id = 'div_hono_button_';

	var att = document.createAttribute("class");
	att.value = 'div_hono_button ' + div_hono_button_class;
	button.setAttributeNode(att); 

	button.style = div_hono_button_css + ButtonPosition(div_hono_button_position);
 
	button.appendChild(document.createTextNode(div_hono_button_text));
	allreadyTextOnButton = true;
	div_hono.appendChild(button);
 
}

/**
 * [appendStyle description]
 * @param  {[type]} styles [description]
 * @return {[type]}        [description]
 */
function appendStyle(styles) {
  var css = document.createElement('style');
  css.type = 'text/css';

  if (css.styleSheet) css.styleSheet.cssText = styles;
  else css.appendChild(document.createTextNode(styles));

  document.getElementsByTagName("head")[0].appendChild(css);
}

/**
 * [langValue description]
 * @param  {[type]} key [description]
 * @return {[type]}     [description]
 */
function langValue(key){
	return (typeof array_lang_value[div_hono_button_lang] != 'undefined')?((typeof array_lang_value[div_hono_button_lang][key] != 'undefined')? array_lang_value[div_hono_button_lang][key]: ''): '--Bad-Lang-Key--';
}

var honoLOG = function(str){
	// Of course, log doen't need to be convert in Lang
	console.log("HONO > "+str);
}
var checkingParameters = function(value, attribute_name){
	(typeof value === 'undefined' || value == null || value === null) ? honoLOG(attribute_name+' is not valid or doesn\'t exist') : a++;
	return (typeof value === 'undefined' || value == null || value === null) ? false : true;
}
// Sha1
var SHA1 = function(msg){function rotate_left(n,s){var t4=(n<<s)|(n>>>(32-s));return t4};function lsb_hex(val){var str="";var i;var vh;var vl;for(i=0;i<=6;i+=2){vh=(val>>>(i*4+4))&0x0f;vl=(val>>>(i*4))&0x0f;str+=vh.toString(16)+vl.toString(16)}return str};function cvt_hex(val){var str="";var i;var v;for(i=7;i>=0;i--){v=(val>>>(i*4))&0x0f;str+=v.toString(16)}return str};function Utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128)}else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128)}}return utftext};var blockstart;var i,j;var W=new Array(80);var H0=0x67452301;var H1=0xEFCDAB89;var H2=0x98BADCFE;var H3=0x10325476;var H4=0xC3D2E1F0;var A,B,C,D,E;var temp;msg=Utf8Encode(msg);var msg_len=msg.length;var word_array=new Array();for(i=0;i<msg_len-3;i+=4){j=msg.charCodeAt(i)<<24|msg.charCodeAt(i+1)<<16|msg.charCodeAt(i+2)<<8|msg.charCodeAt(i+3);word_array.push(j)}switch(msg_len%4){case 0:i=0x080000000;break;case 1:i=msg.charCodeAt(msg_len-1)<<24|0x0800000;break;case 2:i=msg.charCodeAt(msg_len-2)<<24|msg.charCodeAt(msg_len-1)<<16|0x08000;break;case 3:i=msg.charCodeAt(msg_len-3)<<24|msg.charCodeAt(msg_len-2)<<16|msg.charCodeAt(msg_len-1)<<8|0x80;break}word_array.push(i);while((word_array.length%16)!=14)word_array.push(0);word_array.push(msg_len>>>29);word_array.push((msg_len<<3)&0x0ffffffff);for(blockstart=0;blockstart<word_array.length;blockstart+=16){for(i=0;i<16;i++)W[i]=word_array[blockstart+i];for(i=16;i<=79;i++)W[i]=rotate_left(W[i-3]^W[i-8]^W[i-14]^W[i-16],1);A=H0;B=H1;C=H2;D=H3;E=H4;for(i=0;i<=19;i++){temp=(rotate_left(A,5)+((B&C)|(~B&D))+E+W[i]+0x5A827999)&0x0ffffffff;E=D;D=C;C=rotate_left(B,30);B=A;A=temp}for(i=20;i<=39;i++){temp=(rotate_left(A,5)+(B^C^D)+E+W[i]+0x6ED9EBA1)&0x0ffffffff;E=D;D=C;C=rotate_left(B,30);B=A;A=temp}for(i=40;i<=59;i++){temp=(rotate_left(A,5)+((B&C)|(B&D)|(C&D))+E+W[i]+0x8F1BBCDC)&0x0ffffffff;E=D;D=C;C=rotate_left(B,30);B=A;A=temp}for(i=60;i<=79;i++){temp=(rotate_left(A,5)+(B^C^D)+E+W[i]+0xCA62C1D6)&0x0ffffffff;E=D;D=C;C=rotate_left(B,30);B=A;A=temp}H0=(H0+A)&0x0ffffffff;H1=(H1+B)&0x0ffffffff;H2=(H2+C)&0x0ffffffff;H3=(H3+D)&0x0ffffffff;H4=(H4+E)&0x0ffffffff}var temp=cvt_hex(H0)+cvt_hex(H1)+cvt_hex(H2)+cvt_hex(H3)+cvt_hex(H4);return temp.toLowerCase()}

var getCurrentHonoKey = function(){
	var generator = new IDGenerator();

	if(getCookie("hono_"+location.href+"_key") == null) {
		setCookie("hono_"+location.href+"_key", SHA1('Hono'+ (generator.generate()+location.href+'key')), 365);
	}

	return getCookie("hono_"+location.href+"_key");
}


/**
 * [checkTheMarginOfThePrice description]
 * @param  {[type]} amount        [description]
 * @param  {[type]} amount_enter  [description]
 * @param  {[type]} amount_margin [description]
 * @return {[type]}               [description]
 */
var checkTheMarginOfThePrice = function(amount, amount_enter, amount_margin){
	return (amount_enter >= (amount - amount*(amount_margin/100)))? true: false;
}

/**
 * [ButtonPosition description]
 * @param {[type]} position [description]
 */
var ButtonPosition = function(position){
	if(position == "standard"){
		return '';
	}else if(position == "float-left"){
		return 'position:fixed!important;left:0!important;bottom:0!important;';
	}else if(position == "float-right"){
		return 'position:fixed!important;right:0!important;bottom:0!important;';
	}else{
		return '';
	}
}
var treepoint = function(elt, sizemax){
  if(elt.length>sizemax)
    return "...";
  else
    return "";
}

var size_word = function (stringg, size){
  return stringg.substring(0, size)+treepoint(stringg, size);
}

var toggleModal = function () {
   modal.classList.toggle("show-modal");
}

var windowOnClick = function (event) {
   if (event.target === modal) {
       toggleModal();
   }
}


/**
 * Cookies Management ////////
 */
var getCookie = function (c_name) {
	var c_value = document.cookie;
	var c_start = c_value.indexOf(" " + c_name + "=");
	if (c_start == -1) {
	    c_start = c_value.indexOf(c_name + "=");
	}
	if (c_start == -1) {
	    c_value = null;
	}
	else {
	  	c_start = c_value.indexOf("=", c_start) + 1;
	  	var c_end = c_value.indexOf(";", c_start);
	  	if (c_end == -1) {
			c_end = c_value.length;
		}
		c_value = unescape(c_value.substring(c_start,c_end));
	}
	return c_value;
}
var setCookie = function (c_name,value,exdays) {
	var exdate=new Date();
	exdate.setDate(exdate.getDate() + exdays);
	var c_value=escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());
	document.cookie=c_name + "=" + c_value;
}
var delcookie = function (name) {
    setCookie(name,"",-1);
}

/**
 * [BuildModal description]
 * @param {[type]} title         [title of the product]
 * @param {[type]} amount        [Amount of the product]
 * @param {[type]} margin_amount [margin on the price for the product]
 * @param {[type]} currency      [The actual currency]
 */
var modal;
var BuildModal = function(title, amount, margin_amount, currency){

	var hono_cookie_numero = (getCookie("hono_tel") != null) ?  getCookie("hono_tel") : '',
	hono_cookie_email = (getCookie("hono_email") != null) ?  getCookie("hono_email") : '',
	div = document.createElement("div");
	div.id = "hono_modal";
	div.innerHTML = '<div class="modal" style="display:none;">'+
		'<div class="modal-content" style="text-align: center;">'+
            '<span class="close-button" style="display:none;">×</span> '+
            '<center>'+
            	'<img src="'+image_logo+'">'+
                '<div id="hono_prix_box">'+
                	'<h3>'+langValue("MODAL_TITLE")+' :<br>"'+size_word(title, 17)+'" ['+amount+currency+']</h3>'+
                    '<table style="width: 90%;margin-top:-10px;">'+
                        '<tr>'+
                            '<td style="width: 80%;text-align: left;">'+
                                '<label style="font-size:14px;">'+langValue("MODAL_HOW_MUCH_DO_YOU_HAVE")+'<br><input autofocus="" type="number" id="myprice" placeholder="'+amount+'" style="width: 100%;" maxlength="10" max="9999999" ></label>'+
                            '</td>'+
                            '<td style="text-align: left;"><br><span id="currency"> &nbsp; '+currency.toUpperCase()+'</span></td>'+
                        '</tr>'+
                    '</table><br>'+
                    '<input type="button" value="'+langValue("MODAL_NEXT_BUTTON")+'" id="hono_suivant" onclick="slidedingBox('+amount+', '+margin_amount+')">'+
                '</div>'+
                '<div id="hono_contact_box" style="display: none;">'+
                    '<span style="font-size: 13px;">'+
                        langValue("MODAL_LEAVE_INFO")+'<br>'+
                    '</span><br>'+
                    '<table style="width: 90%;">'+
                        '<tr>'+
                            '<td><input type="text" style="width:100%;" maxlength="25" id="hono_numeroTel" value="'+hono_cookie_numero+'" placeholder="'+langValue("MODAL_ASK_NUMBER")+'"></td>'+
                            '<td style="width:5%"></td>'+
                            '<td><input type="text" style="width:100%;" maxlength="50" id="hono_Email" value="'+hono_cookie_email+'" placeholder="Email* "></td>'+
                        '</tr>'+
                        '<tr>'+
                            '<td colspan="3">'+
                                '<br><textarea id="hono_Message" maxlength="100" row="7" placeholder="'+langValue("MODAL_LEAVE_MESSAGE_PLACEHOLDER")+'" style="width: 100%;"></textarea>'+
                            '</td>'+
                        '</tr>'+
                    '</table><br>'+
                    '<input type="button" value="'+langValue("MODAL_SEND_BUTTON")+'" id="hono_envoyer" onclick="slidedingBox2()"">'+
                '</div>'+
                '<div id="hono_contact_box_2" style="font-size:15px;display: none;">'+
                    '<span style="color:green;">'+langValue("MODAL_MESSAGE_SENT_SUCCESS")+'</span><br>'+langValue("MODAL_INDICATION_MESSAGE1")+'<a target="_blank" href="https://jeveutchat.herokuapp.com/chat.html?name=Client&room='+getCurrentHonoKey()+'">'+langValue("MODAL_INDICATION_MESSAGE2")+'</a>.'+
                '</div>'+
            '</center>'+
        '<small style="float:right;font-size:12px;margin-top:10px;">By Hono</small>'+
    '</div></div>';
	document.body.appendChild(div);
    
	modal = document.querySelector(".modal");
    var closeButton = document.querySelector(".close-button");
    closeButton.addEventListener("click", toggleModal);
}

window.addEventListener("click", windowOnClick);


var isNumberOrNot = function(str, attributes){
	return (isNaN(str))? honoLOG(+attributes+" is not a valid number"): a++;
}


var display_hide = function(id_elet, show){
	(show) ? document.getElementById(id_elet).style.display = "block": document.getElementById(id_elet).style.display = "none";
}
var slidedingBox = function(amount, margin_amount){
	if(checkTheMarginOfThePrice(amount, document.getElementById('myprice').value, margin_amount)){
		display_hide('hono_prix_box', false);
		display_hide('hono_contact_box_2', false);
		display_hide('hono_contact_box', true);

		setCookie("hono_amount"+getCurrentHonoKey(), document.getElementById('myprice').value, 30);

	}else{
		if(div_hono_number_trying == 0){
			display_hide('div_hono_button_', false);
			document.querySelector('.close-button').click();
			honoLOG("Blocking the Negociation Button");
			setCookie("hono_tetu"+getCurrentHonoKey(), 1, 7);
		}else{
			alert(langValue("ALERT_YOURMONEY_TOO_SMALL1")+' '+div_hono_number_trying+' '+langValue("ALERT_YOURMONEY_TOO_SMALL2"));
			div_hono_number_trying--;
			var dejadeja = +getCookie("dejaTest"+getCurrentHonoKey()) + 1;
			setCookie("dejaTest"+getCurrentHonoKey(), dejadeja, 3);
		}
	}
}
var slidedingBox2 = function(){
	if(document.getElementById('hono_Email').value != '' && document.getElementById('hono_Message').value != ''){
		// hono_contact_box_2
		display_hide('hono_prix_box', false);
		display_hide('hono_contact_box', false);
		display_hide('hono_contact_box_2', true);
		
		if(document.getElementById('hono_numeroTel').value!=''){
			setCookie("hono_tel", document.getElementById('hono_numeroTel').value, 30);
		}
		if(document.getElementById('hono_Email').value!=''){
			setCookie("hono_email", document.getElementById('hono_Email').value, 30);
		}

		// Envoi du mail
		Email.send({
			SecureToken : "fc591fd1-3bb9-442a-a733-82585edb89a5",
			To : div_hono_emailseller,
			From : "honobutton@gmail.com",
			Subject : "HONO - ["+document.getElementById('myprice').value+"] "+div_hono_product_title,
			Body : "<h4><u>HONOSYSTEMS</u></h4><br>"+
			langValue("EMAIL_HELLO_MESSAGE")+":<br><hr>"+
			"<b>"+langValue("EMAIL_INTITULE_ARTICLE")+":</b> "+window.location.hostname+" -- <a href="+location.href+" target='_blank'>"+div_hono_product_title+"</a><br>"+
			"<b>"+langValue("EMAIL_INTITULE_AMOUNT")+":</b> "+div_hono_product_amount+" "+div_hono_product_currency+"<br>"+
			"<b>"+langValue("EMAIL_INTITULE_PROPOSITION")+":</b> "+document.getElementById('myprice').value+" "+div_hono_product_currency+"<br>"+
			"<b>"+langValue("EMAIL_INTITULE_EMAIL")+":</b> "+document.getElementById('hono_Email').value+"<br>"+
			"<b>"+langValue("EMAIL_INTITULE_NUMERO")+":</b> "+document.getElementById('hono_numeroTel').value+"<br>"+
			"<b>"+langValue("EMAIL_INTITULE_MESSAGE")+":</b><br> <i>'"+size_word(document.getElementById('hono_Message').value, 200)+"'</i><br><hr>"+
			langValue("EMAIL_JOIN_TCHAT_MESSAGE1")+' <a target="_blank" href="https://jeveutchat.herokuapp.com/chat.html?name=Seller&room='+getCurrentHonoKey()+'">'+langValue("EMAIL_JOIN_TCHAT_MESSAGE2")+'</a><br><br>'+
			'<i><small style="font-size:12px;">'+datetime+' By Hono</small></i>'
		}).then(
		 message => {
			honoLOG(message);
			honoLOG("Mail send.");
		  }
		);

		setCookie("hono_done_here"+getCurrentHonoKey(), 1, 30);
	}else{
		alert("FILL_CORRECTLY_FORMMAIL");
	}
}

/**
 * [Manage_auto_Load description]
 * This function check the loading Way! Or call back
 */
function Manage_auto_Load(){
	if(div_hono_autoload_action == "onclosepage"){
		window.onbeforeunload = function() {
			BuildButton(button);
			return "Do you really want to leave? You can Negociate the price.";
		};
	}else if(div_hono_autoload_action == "onCallBack"){

	}else if(div_hono_autoload_action.contains("onwait")){
		setTimeout(function(){
			BuildButton(button);
		}, +(div_hono_autoload_action.replaceAll("onwait-", "")*1000));
	}else if(div_hono_autoload_action == "onclick"){
		BuildButton(button);
	}else{
		honoLOG("Problem with your 'data-autoload-action' ");
	}
}

/**
 * [honolaunch description]
 * @return {[type]} [description]
 */
function honolaunch(){
	//The call back to build the button from an external code
	BuildButton(button);
}

/**
 * [List of strings prototype description]
 */
String.prototype.replaceAll = function(search, replacement) {
    var target = this;
    return target.replace(new RegExp(search, 'g'), replacement);
};
String.prototype.contains = function(it) { return this.indexOf(it) != -1; };


/**
 * --------------------------------------------------------------------------------------
 * MAIN CODE ////////////////////////////////////////////////////////////////////////////
 * --------------------------------------------------------------------------------------
*/
// Variables
// delcookie("hono_tetu"+getCurrentHonoKey());
// delcookie("hono_done_here"+getCurrentHonoKey());
// delcookie("dejaTest"+getCurrentHonoKey());
// delcookie("hono_"+location.href+"_key");
// This variables is for delinuants lol()
var tetu = getCookie("hono_tetu"+getCurrentHonoKey()),
	done_here = getCookie("hono_done_here"+getCurrentHonoKey()),
	dejaTest = getCookie("dejaTest"+getCurrentHonoKey());

// Getting Parameters
var div_hono = document.getElementById("div_hono"),
	div_hono_key = getRealValue_or_default(div_hono.getAttribute("data-key"), ''),
	
	// Time to appear ...

	// Product informations
	div_hono_product_image = getRealValue_or_default(div_hono.getAttribute("data-product-image"), image_logo),
	div_hono_product_title = div_hono.getAttribute("data-product-title"),
	div_hono_product_currency = div_hono.getAttribute("data-product-currency"),
	div_hono_product_amount = div_hono.getAttribute("data-product-amount").replace(/\,/g,"").replace(/\ /g,""),
	div_hono_product_margin_amount = div_hono.getAttribute("data-product-margin-amount").replace(/\,/g,"."),
	div_hono_button_lang = getRealValue_or_default(div_hono.getAttribute("data-button-lang"), 'en'),

	div_hono_emailseller = div_hono.getAttribute("data-emailseller"), // Email to contact

	// auto load of the product LESS IMPORTANT
	div_hono_id = getRealValue_or_default(div_hono.getAttribute("data-id"), "div_hono_element"),  // A personnal id, it's facultative and attribuate automaticaly when it's not provide
	div_hono_autoload_action = getRealValue_or_default(div_hono.getAttribute("data-autoload-action"), "onclick"), // onclosepage, onclick, onCallBack, onwait-10
	div_hono_button_position = getRealValue_or_default(div_hono.getAttribute("data-button-position"), "standard"), // float-left , float-right, standard, ''
	div_hono_button_css = getRealValue_or_default(div_hono.getAttribute("data-button-css"), ''),
	div_hono_button_class = getRealValue_or_default(div_hono.getAttribute("data-button-class"), ''),
	div_hono_button_text = langValue("HONO_BUTTON"), // Chercher en differentes langue aussi
	
	// From the button on the div Hono
	div_hono_number_trying = getRealValue_or_default(div_hono.getAttribute("data-number-trying"), 5); // Le nombre d'essaies restant apres que le user propose son prix

	div_hono.setAttribute("data-key", getCurrentHonoKey());


if(dejaTest != null && dejaTest > 5){
	honoLOG("Tetu guy detected");
}else{
	// Si le client a deja eu a conclure une cerrtaines somme
	if(done_here != null){

		// Check if the class attribute of button have some of....
		if(div_hono_button_class.contains('honobtnFade') || 
			div_hono_button_class.contains('honobtnPush') || 
			div_hono_button_class.contains('honobtnBorder') ||
			div_hono_button_class.contains('honobtnFloat') ||
			div_hono_button_class.contains('honobtnSlide')){
			appendStyle(Buttonstyles);
		}

		var button = document.createElement("button");
		// Check and act the auto load Way
		Manage_auto_Load();

		// The click on the button
		button.addEventListener("click", function(event){
			event.preventDefault();
			// Building the Modal
			window.open('https://jeveutchat.herokuapp.com/chat.html?name=Client&room='+getCurrentHonoKey(), '_blank');
		});
	}else{

		// On check si le user n'est pas un tetue qui 's'est amuser a depasser son delaie d'essaies de proposition de prix
		if(tetu == null){

			// Test if some values are numeric or not (and return )
			isNumberOrNot(div_hono_product_amount, 'data-product-amount');
			isNumberOrNot(div_hono_product_margin_amount, 'data-product-margin-amount');
			isNumberOrNot(div_hono_number_trying, 'data-number-trying');

			// Checking the most important parameters
			if(checkingParameters(div_hono.getAttribute('data-product-title'), 'data-product-title') && 
				checkingParameters(div_hono.getAttribute('data-product-currency'), 'data-product-currency') &&
				checkingParameters(div_hono.getAttribute('data-product-amount'), 'data-product-amount') &&
				checkingParameters(div_hono.getAttribute('data-product-margin-amount'), 'data-product-margin-amount') &&
				checkingParameters(div_hono.getAttribute('data-emailseller'), 'data-emailseller')
				){
					// Building the button
					var button = document.createElement("button");
					// Check and act the auto load Way
					Manage_auto_Load();

					honoLOG("Hono's site Key: "+getCurrentHonoKey());

					// The click on the button
					button.addEventListener("click", function(event){
						event.preventDefault();
						// Building the Modal
						BuildModal(div_hono_product_title, 
									div_hono_product_amount, 
									div_hono_product_margin_amount, 
									div_hono_product_currency);
						toggleModal();
					});

			}else{
				alert("HONO > ERROR, check well required parameters! See your Console.");
			}
			
		}else{
			honoLOG("Tetu guy detected");
		}

	}
}
